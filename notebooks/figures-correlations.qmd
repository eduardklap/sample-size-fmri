---
title: "Code for Figures 3-4 based on Pearson's correlations"
author: "Eduard Klapwijk"
---

Load libraries to produce figures:

```{r setup, eval = FALSE, echo = TRUE, message = FALSE, warning = FALSE}
# load libraries
library(dplyr)
library(patchwork)
# load devtools library and load neuro-up package from github repo
library(devtools)
install_github("eduardklap/neuroUp")
library(neuroUp)

```

Set seed and create Figure 3A for the Feedback task DLPFC ROI:

```{r Figure 3a, eval = FALSE, echo = TRUE, message = FALSE, warning = FALSE}
# set seed
set.seed(1234)

# calculate difference mfg_learning vs. mfg_application
data_feedback <- feedback
data_feedback$dif <- data_feedback$mfg_learning - data_feedback$mfg_application

# Estimate correlations
Fig3a <- estim_corr(data = data_feedback,
                    vars_of_interest = c("dif", "age"),
                    sample_size = 20:271, 
                    k = 1000, 
                    name = "A. Feedback DLPFC corr. with age")

```

Set seed and create Figure 3B for the Gambling task NAcc ROI:

```{r Figure 3b, eval = FALSE, echo = FALSE, message = FALSE, warning = FALSE}
# set seed
set.seed(1234)

# Estimate correlations
Fig3b <- estim_corr(data = gambling, 
                    vars_of_interest = c("lnacc_self_winvsloss", 
                                         "age"), 
                    sample_size = 20:221, 
                    k = 1000, 
                    name = "B. Gambling NAcc corr. with age")

```

Set seed and create Figure 3C for the Self-evaluations task mPFC ROI:

```{r Figure 3c, eval = FALSE, echo = FALSE, message = FALSE, warning = FALSE}
# set seed
set.seed(1234)

# calculate difference mpfc_self - mpfc_control
data_self <- self_eval
data_self$dif <- data_self$mpfc_self - data_self$mpfc_control

# Estimate correlations
Fig3c <- estim_corr(data = data_self,
                    vars_of_interest = c("dif",
                                         "age"),
                    sample_size = 20:149, 
                    k = 1000, 
                    name = "C. Self-evaluations mPFC corr. with age")

```

Set seed and create Figure 3D for the Gaining for self task NAcc ROI:

```{r Figure 3d, eval = FALSE, echo = FALSE, message = FALSE, warning = FALSE}
# set seed
set.seed(1234)

# calculate difference nacc_selfgain vs. nacc_bothnogain
data_vicar <- vicar_char
data_vicar$dif <- data_vicar$nacc_selfgain - data_vicar$nacc_bothnogain

# Estimate correlations
Fig3d <- estim_corr(data = data_vicar, 
                    vars_of_interest = c("diff", 
                                         "age"),
                    sample_size = 20:156, 
                    k = 1000, 
                    name = "D. Gaining self left NAcc corr. with age")

```

Combine figures 3A-D in one figure for Pearson's correlations:

```{r Figure 3 combination, eval = FALSE, echo = FALSE, message = FALSE, warning = FALSE, fig.height = 6, fig.width = 10}

Fig3a$fig_corr + Fig3b$fig_corr + Fig3c$fig_corr + Fig3d$fig_corr

```

Combine figures 4A-D in one figure for the proportion of intervals not containing the value 0:

```{r Figure 4 combination, eval = FALSE, echo = FALSE, message = FALSE, warning = FALSE, fig.height = 6, fig.width = 10}

Fig3a$fig_corr_nozero + Fig3b$fig_corr_nozero + Fig3c$fig_corr_nozero + Fig3d$fig_corr_nozero

```

Extract numbers to make table 3:

```{r Results table correlations, eval = FALSE, echo = FALSE, message = FALSE, warning = FALSE}

# first extract tibble from results (select mean only)
feedback <- as_tibble(Fig3a$tbl_select) %>%
  dplyr::filter(permutation == "Overall")
gambling <- as_tibble(Fig3b$tbl_select) %>%
  dplyr::filter(permutation == "Overall")
selfeval <- as_tibble(Fig3c$tbl_select) %>%
  dplyr::filter(permutation == "Overall")
gaining <- as_tibble(Fig3d$tbl_select) %>%
  dplyr::filter(permutation == "Overall")

# use numbers to make a table in text

```
